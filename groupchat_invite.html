<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
		<!--Meta-->
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		
		<!--Title-->
		<title>Weruchat - Invite</title>
		
		<!--Scripts-->
		<script type="text/javascript" src="scripts/shared.js"></script>
		<script type="text/javascript" src="scripts/switchStyle.js"></script>
		<script type="text/javascript" src="scripts/jsjac.js"></script>
		<script type="text/javascript">
			<!--
			
			function doSub(){
			    if (document.forms[0].invite[0].checked) {
			        srcW.openGroupchat(to, srcW.jid.substring(0, srcW.jid.indexOf('@')), pass);
			    }
			    else { // decline
			        var aMessage = new JSJaCMessage();
			        aMessage.setTo(to);
			        var x = aMessage.appendNode('x', {
			            'xmlns': 'http://jabber.org/protocol/muc#user'
			        });
			        var decline = x.appendChild(aMessage.getDoc().createElement('decline'));
			        decline.setAttribute('to', from);
			        if (document.forms[0].reason.value != '') 
			            decline.appendChild(aMessage.getDoc().createElement('reason')).appendChild(aMessage.getDoc().createTextNode(document.forms[0].reason.value));
			        srcW.con.send(aMessage);
			    }
			    window.close();
			}
			
			var srcW, to, from, pass;
			function init(){
			    srcW = opener;
			    
			    getArgs();
			    
			    to = passedArgs['to'];
			    from = passedArgs['from'];
			    pass = passedArgs['pass'];
			    var reason = passedArgs['reason'];
			    
			    document.getElementById('to').innerHTML = to;
			    document.getElementById('from').innerHTML = "<span class=\"link\" onClick=\"return srcW.openUserInfo('" + from + "');\">" + from + "</span>";
			    
			    if (typeof(reason) != 'undefined' && reason != 'undefined') 
			        document.getElementById('reason').innerHTML = htmlEnc(reason);
			    else 
			        document.getElementById('reason').innerHTML = "None Given";
			    
			    document.title = "Invitation to " + to;
			}
			
			onload = init;
			//-->
		</script>
	</head>
	<body>
		<h2 id="title">Groupchat Invitation</h2>
		<ul>
			<li>
				Room: <span id="to"></span>
			</li>
			<li>
				From: <span id="from"></span>
			</li>
			<li>
				Reason: <span id="reason"></span>
			</li>
		</ul>
		<form name="sub" onsubmit=" return doSub();">
			<fieldset>
				<legend class="hidden"></legend>
				<ol>
					<li>
						<label for="join">
							<input type="radio" id="join" name="invite" value="join" checked="checked" /> Join
						</label>
					</li>
					<li>
						<label for="decline">
							<input type="radio" id="decline" name="invite" value="decline" /> Decline
						</label>
					</li>
					<li>
						<label for="reason">Reason</label>
						<textarea id="reason" name="reason" class="large"></textarea>
					</li>
					<li>
						<input type="submit" value="Submit" />
					</li>
				</ol>
			</fieldset>
		</form>
	</body>
</html>