<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
		<!--Meta-->
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		
		<!--Title-->
		<title>Weruchat - Subscription request</title>
		
		<!--Scripts-->
		<script type="text/javascript" src="scripts/shared.js"></script>
		<script type="text/javascript" src="scripts/emoticons.js"></script>
		<script type="text/javascript" src="scripts/switchStyle.js"></script>
		<script type="text/javascript" src="scripts/jsjac.js"></script>
		<script type="text/javascript">
			<!--
			var jid;
			var msg;
			var srcW; // the source window with necessary data
			function sendSub(){
			    var aPresence = new JSJaCPresence();
			    aPresence.setTo(jid);
			    aPresence.setType('subscribed');
			    
			    srcW.con.send(aPresence);
			    
			    // maybe we want to subscribe to?
			    
			    var user = srcW.roster.getUserByJID(jid);
			    if (!user || (user.subscription != 'both' && user.subscription != 'to')) 
			        srcW.openSubscription(jid);
			    
			    window.close();
			}
			
			function sendUnsub(){
			    var aPresence = new JSJaCPresence();
			    aPresence.setTo(jid);
			    aPresence.setType('unsubscribed');
			    
			    window.close();
			}
			
			function init(){
			    // determine source window
			    srcW = opener;
			    
			    getArgs();
			    jid = passedArgs['jid'];
			    if (typeof(passedArgs['msg']) != 'undefined') 
			        msg = passedArgs['msg'];
			    
			    document.title = "Subscribe request from " + jid;
			    
			    var from = "<b><span class=\"link\" onClick=\"return srcW.openUserInfo('" + jid + "');\" title=\"" + "show user info for " + jid + "\">" + jid.substring(0, jid.indexOf('@')) + "</a></b> ";
			    
			    document.getElementById("requestingUser").innerHTML = from;
			    if (msg) 
			        msgbox.document.body.innerHTML = msgFormat(msg);
			}
			
			function keyPressed(e){
			    if (e.ctrlKey && e.keyCode == 13) 
			        sendSub();
			    else 
			        if (e.keyCode == 27) 
			            window.close();
			}
			
			onkeydown = keyPressed;
			onload = init;
			//-->
		</script>
		<script for="document" event="onkeydown()" language="JScript">
			<!--
			if (window.event.ctrlKey && window.event.keyCode == 13) 
			    sendSub();
			if (window.event.keyCode == 27) 
			    window.close();
			//-->
		</script>
	</head>
	<body>
		<p><span id="requestingUser"></span> wants to add you to his roster:</p>
		<iframe src="chat_iframe.html" id="msgbox" name="msgbox" scrolling="yes" class="msgbox"></iframe>
		<form name="sub">
			<button onclick="return sendUnsub();">Deny</button>
			<button onclick="return sendSub();" tabindex=1>Allow</button>
		</form>
	</body>
</html>